<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Richgo2</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- 네이버지도 기본형 -->

    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=cd7j520imp"></script>



    <script type="text/javascript"
        src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=YOUR_CLIENT_ID&submodules=panorama"></script>


    <!-- 네이버지도 검색 후 정보호출 -->
    <script type="text/javascript"
        src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=cd7j520imp&submodules=geocoder"></script>

    <link href="../css/reset.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="../css/myRichgo.css" rel="stylesheet">

</head>

<body>
    <table id="nmap">
        <tr>
            <td><input type="text" name="address" id="address" autoComplete="off"></td>
            <td><button id="nbtn1"">검색</button></td>
        </tr>
    </table>
    <!-- <button type="button" id="btn2">버튼2</button> -->
    <!-- 방법 3-1 -->
    <!-- <button type="button" id="btn3" onclick="(function(){console.log('방법3(인라인방식) : '+date);})()">버튼3</button> -->

    <!-- 방법 3-2 -->
    <!-- <button type="button" id="btn3" onclick="cbF3();">버튼3</button> -->

    <form method="get" action="#" id="ftest">
        <!-- <input type="text" name="n1"> -->
        <!-- <button type="submit" onclick="return cbF3();">서브밋 버튼</button> -->
        <!-- id와 인라인이벤트 등록방식을 쓰지말 것. -->
    </form>

    <script>

        // 이벤트 발생시 기능 추가. 예)클릭시 로그에 현재시간 출력해줘.


        // 방법 3 
        // var cbF1 = function () {
        //     console.log("방법1(고전방식) : " + date);
        // }
        // var cbF2 = function () {
        //     console.log("방법2(표준방식) : " + date);
        // }
        // var cbF3 = function () {
        //     console.log("방법3(인라인방식) : " + date);
        //     return true;
        //     // onclick이 먼저 진행하며, 리턴이 true일경우 다음 onsubmit을 진행시켜줌.
        //     // 예) 회원가입시 id중복확인을 클릭해야 다음으로 진행!
        // }

        // onsubmit 방식
        // var frmEle = document.getElementById('ftest');
        // frmEle.onsubmit = cbF1;


        // 방법 2
        //        btn1Elem.addEventListener('click', function () { console.log("방법2(표준방식) : " + date); });
        //        var btn1Elem = document.getElementById('btn1');
        //        </script>
    <!--    
    // <table id="nmap">
    //     <tr>
    //         <td><input type="text" name="address" autoComplete="off"></td>
    //         <td><button id="btn1"">검색</button></td>
    //     </tr>
    // </table>
   -->

    <!-- 네이버지도 호출 -->

    <div id="map" style="width:100%; height:1080px;"></div>
    <div class="test">
        <div id="result" class="fixed modal"></div>
    </div>

    <script>

        var map = new naver.maps.Map("map", {
            center: new naver.maps.LatLng(37.4985248, 127.0326343),
            zoom: 17,
            mapTypeControl: true
        });

        var infoWindow = new naver.maps.InfoWindow({
            anchorSkew: true
        });

        map.setCursor('pointer');

        function searchCoordinateToAddress(latlng) {

            infoWindow.close();

            naver.maps.Service.reverseGeocode({
                coords: latlng,
                orders: [
                    naver.maps.Service.OrderType.ADDR,
                    naver.maps.Service.OrderType.ROAD_ADDR
                ].join(',')
            }, function (status, response) {
                if (status === naver.maps.Service.Status.ERROR) {
                    return alert('Something Wrong!');
                }

                var items = response.v2.results,
                    address = '',
                    htmlAddresses = [];

                for (var i = 0, ii = items.length, item, addrType; i < ii; i++) {
                    item = items[i];
                    address = makeAddress(item) || '';
                    addrType = item.name === 'roadaddr' ? '[도로명 주소]' : '[지번 주소]';

                    htmlAddresses.push((i + 1) + '. ' + addrType + ' ' + address);
                }

                infoWindow.setContent([
                    '<div style="padding:10px;min-width:200px;line-height:150%;">',
                    '<h4 style="margin-top:5px;">검색 좌표</h4><br />',
                    htmlAddresses.join('<br />'),
                    '</div>'
                ].join('\n'));

                infoWindow.open(map, latlng);
            });
        }

        function searchAddressToCoordinate(address) {
            naver.maps.Service.geocode({
                query: address
            }, function (status, response) {
                if (status === naver.maps.Service.Status.ERROR) {
                    return alert('Something Wrong!');
                }

                if (response.v2.meta.totalCount === 0) {
                    return alert('totalCount' + response.v2.meta.totalCount);
                }

                var htmlAddresses = [],
                    item = response.v2.addresses[0],
                    point = new naver.maps.Point(item.x, item.y);

                if (item.roadAddress) {
                    htmlAddresses.push('[도로명 주소] ' + item.roadAddress);
                }

                if (item.jibunAddress) {
                    htmlAddresses.push('[지번 주소] ' + item.jibunAddress);
                }

                if (item.englishAddress) {
                    htmlAddresses.push('[영문명 주소] ' + item.englishAddress);
                }

                infoWindow.setContent([
                    '<div style="padding:10px;min-width:200px;line-height:150%;">',
                    '<h4 style="margin-top:5px;">검색 주소 : ' + address + '</h4><br />',
                    htmlAddresses.join('<br />'),
                    '</div>'
                ].join('\n'));

                map.setCenter(point);
                infoWindow.open(map, point);
            });
        }
        // 검색 기능!!
        function initGeocoder() {
            map.addListener('click', function (e) {
                searchCoordinateToAddress(e.coord);
            });

            $('#address').on('keydown', function (e) {
                var keyCode = e.which;

                if (keyCode === 13) { // Enter Key
                    searchAddressToCoordinate($('#address').val());
                }
            });

            $('#submit').on('click', function (e) {
                e.preventDefault();

                searchAddressToCoordinate($('#address').val());
            });
            // 검색할 주소
            searchAddressToCoordinate(document.getElementById(''));
            // searchAddressToCoordinate(document.getElementById('address'));
        }
    </script>

   
    <script>

        function makeAddress(item) {
            if (!item) {
                return;
            }

            var name = item.name,
                region = item.region,
                land = item.land,
                isRoadAddress = name === 'roadaddr';

            var sido = '', sigugun = '', dongmyun = '', ri = '', rest = '';

            if (hasArea(region.area1)) {
                sido = region.area1.name;
            }

            if (hasArea(region.area2)) {
                sigugun = region.area2.name;
            }

            if (hasArea(region.area3)) {
                dongmyun = region.area3.name;
            }

            if (hasArea(region.area4)) {
                ri = region.area4.name;
            }

            if (land) {
                if (hasData(land.number1)) {
                    if (hasData(land.type) && land.type === '2') {
                        rest += '산';
                    }

                    rest += land.number1;

                    if (hasData(land.number2)) {
                        rest += ('-' + land.number2);
                    }
                }

                if (isRoadAddress === true) {
                    if (checkLastString(dongmyun, '면')) {
                        ri = land.name;
                    } else {
                        dongmyun = land.name;
                        ri = '';
                    }

                    if (hasAddition(land.addition0)) {
                        rest += ' ' + land.addition0.value;
                    }
                }
            }

            return [sido, sigugun, dongmyun, ri, rest].join(' ');
        }

        function hasArea(area) {
            return !!(area && area.name && area.name !== '');
        }

        function hasData(data) {
            return !!(data && data !== '');
        }

        function checkLastString(word, lastString) {
            return new RegExp(lastString + '$').test(word);
        }

        function hasAddition(addition) {
            return !!(addition && addition.value);
        }

        naver.maps.onJSContentLoaded = initGeocoder;

    </script>

</body>

</html>
<!-- 
   <script>
        // 참고 url : http://openapi.molit.go.kr/OpenAPI_ToolInstallPackage/service/rest/RTMSOBJSvc/getRTMSDataSvcAptTradeDev?serviceKey=5%2F2ZQI%2F3ERhHWf5sZUCImAHVK5SNcbc%2Bo8W1zCDP4G12ZhIaFupm3sgvzjwFYTSPACF4EctexvJ3WJSNlAiuzw%3D%3D&pageNo=1&numOfRows=10&LAWD_CD=11110&DEAL_YMD=201512

        // 아파트 실거래가 호출
        var xhr = new XMLHttpRequest();
        var url = 'http://openapi.molit.go.kr/OpenAPI_ToolInstallPackage/service/rest/RTMSOBJSvc/getRTMSDataSvcAptTradeDev'; /*URL*/
        var queryParams = '?' + encodeURIComponent('serviceKey') + '=5%2F2ZQI%2F3ERhHWf5sZUCImAHVK5SNcbc%2Bo8W1zCDP4G12ZhIaFupm3sgvzjwFYTSPACF4EctexvJ3WJSNlAiuzw%3D%3D'; /*Service Key*/
        queryParams += '&' + encodeURIComponent('pageNo') + '=' + encodeURIComponent('1'); /**/
        queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('10'); /**/
        queryParams += '&' + encodeURIComponent('LAWD_CD') + '=' + encodeURIComponent('11110'); /**/
        queryParams += '&' + encodeURIComponent('DEAL_YMD') + '=' + encodeURIComponent('201512'); /**/
        xhr.open('GET', url + queryParams);
        xhr.onreadystatechange = function () {
            if (this.readyState == 4) {
                alert('Status: ' + this.status + 'nHeaders: ' + JSON.stringify(this.getAllResponseHeaders()) + 'nBody: ' + this.responseText);
            }
        };
        xhr.send('');
        </script>
         -->